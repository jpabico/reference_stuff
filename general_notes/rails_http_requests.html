<!DOCTYPE html>
<html>
<head>
    <title>HTTP Requests in Rails</title>
    <style>
        ul {
            list-style-type:none;
        }
    </style>

</head>
<body>
    <h1>General notes about HTTP Requests in Rails</h1> 

    <h2>Example 1 - cURL</h2>

        <p>
            The first line of an HTTP request (the request line) contains 4 elements: URI, headers, body, and method.
        </p>

        <pre>
            In routes... 

            BackToBasics::Application.routes.draw do
                match '/curl_example' => 'request_example#curl_get_example', via: :get
                match '/curl_example' => 'request_example#curl_post_example', via: :post
            end
        </pre>

        <pre>
            In the controller...

            class RequestExampleController (less_than_sign) ActionController::Base
                def curl_get_example
                    render text: 'Thanks for sending a GET request with cURL!'
                end

                def curl_post_example
                    render text: 'Thanks for sending a POST request with cURL! Payload: #{request.body.read}'
                end
            end  
        </pre>

        <p>In CLI...  curl -X GET http://localhost:3000/curl_example</p>

        <p>Response = Thanks for sending a GET request with cURL!</p>

        <p>
            In CLI...  curl -X POST -d "backToBasic=for the win"  http://localhost:3000/curl_example
        </p>

        <p>
            Response = Thanks for sending a GET request with cURL! Payload: backToBasics=for the win
        </p>
            
    <h2>Example 2 - Web Browser/Address Bar</h2>

        <pre>
            In routes... 

            BackToBasics::Application.routes.draw do
                root to: 'request_example#index'
                match '/request' => 'request_example#create', via: :post
                match '/request' => 'request_example#create', via: :get
            end
        </pre>

        <pre>
            In the controller...

            class RequestExampleController (less_than_sign) ActionController::Base
                def index
                end

                def create
                    render json: params
                end
            end  
        </pre>

        <p>In address bar... localhost:3000</p>

        <p>results: rails console shows similar results to GET request above</p>

    <h2>Example 3 - Forms</h2>

        <p>
            A form is made up of several key parts.  In the opening form tag, the action attribute tells the form where to send the request.  In addition, the method attribute tells the form what type of request to send to the URI specified in the action attribute.
        </p>

        <p>
            Request bodies are defined by a form's markup.  In the form tag, there's an attribute called enctype that tells the browser how to encode the form data.  The default (application/x-www-form-urlencoded) tells the browser to encode all of the values.  If a form includes a file upload, an enctype of multipart/form-data should be used.  This encodes none of the values.  Finally, there's text/plain that converts spaces but leaves all other characters unencoded.  Inside the form elements, there are several types of input elements, each with a name attribute (to tell the browser what to name the data specified by that input in the message body).
        </p>

        <!-- for more details...  https://html.spec.whatwg.org/multipage/forms.html#form-submission -->

        <pre>
            (angled brackets have been left off due to formatting)

            form action="/request" method='GET'
                input type="text" name="my_data"    //user enters "back to basics"
                input type=submit
            /form
        </pre>

        <p>
            The Rails app will receive the request, but the URL includes a query parameter called my_data (this can been seen in the Rails server log or the console; also, opening Network tab in Chrome developer tools).  This is because a GET request was made, which have no payloads, so it was added to the URI as a query string.
        </p>

        <pre>
            (angled brackets have been left off due to formatting)

            form action="/request" method='POST'
                input type="text" name="my_data"    //user enters "back to basics"
                input type=submit
            /form
        </pre>

        <p>
            Looking at the log/console/dev tools, the URL no longer contains the query parameter.  The parameter hash is identical.  The network tab shows the payload includes something called form data.  The input elements have been converted to a request payload and sent to the server.  As before, the name of the text input element is used as the name associated with the user's text input.
        </p>

    <h2>Example 4 - XMLHttpRequest</h2>

        <p>It's also possible to send requests via Javascript.</p>

        <pre>
            function callback() {
                console.log(this.responseText);
            }
        </pre>  

        <pre>
            AJAX form data...

            var request = new XMLHttpRequest();
            request.onload = callback;
            request.open("post", "http://localhost:3000/request");
            var formData = new FormData();
            formData.append('my_data', 'back to basics');
            request.send(formData);

        </pre>

        <p>
            This is a slightly modified request header to tell the server that it needs to do something slightly different to parse our payload.
        </p>

        <pre>
            AJAX JSON data... 

            var request = new XMLHttpRequest();
            request.onload = callback;
            request.open("post", "http://localhost:3000/request");
            request.setRequestHeader()"Content-Type", "application/json");
            request.send('{"my_data": "back to basics"});
        </pre>

        <p>
            The Rails app is able to parse the payload.
        </p>

</body>
</html>